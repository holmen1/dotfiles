# XMonad Build Factory

This repository provides a streamlined approach for building and distributing XMonad binaries. The core concept is to separate the build process from deployment, allowing you to compile XMonad once on a dedicated "build machine" and then distribute the binary to other systems.

## Build Once, Deploy Anywhere

This approach offers several advantages:
- **Resource Efficiency**: Only one machine needs the full Haskell development environment
- **Minimal Target Systems**: Target machines only need the binary (~2-4MB), not libraries (~100MB+)
- **Consistent Experience**: Same XMonad version across all your machines
- **Simple Updates**: Rebuild and redistribute only when needed (rarely)


### Features
- **Automated Setup**: The `build-xmonad.sh` script handles cloning repositories, building binaries, and installing dependencies.
- **Customizable Configuration**: Easily create and recompile your `xmonad.hs` configuration file.


---

## Build Machine Setup

### Install Dependencies
```bash
# For Arch-based systems
pacman -S xorg-apps xorg-xmessage libx11 libxft libxinerama libxrandr libxss pkgconf xterm

# For Debian-based systems
apt install libx11-dev libxft-dev libxinerama-dev libxrandr-dev libxss-dev pkg-config xterm
```

### Install Haskell
```bash
# Install GHCup
curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org | sh
```

### Config cabal
Create cabal.project file
```
cat > cabal.project <<EOF
packages: ./xmonad ./xmonad-contrib
EOF
```

### Build
```
$ ./build-xmonad.hs
```
**Role of build-xmonad.sh**
The build-xmonad.sh script automates the process of setting up and building xmonad

1. **Clone or Update Repositories**:
   - Clones the xmonad and xmonad-contrib repositories from GitHub if they don't already exist.
   - Updates the repositories if they are already cloned.

2. **Build and Install**:
   - Runs `cabal update` to fetch the latest package information.
   - Installs the xmonad and xmonad-contrib libraries for recompiling the `xmonad.hs` configuration.
   - Installs the xmonad binary to a user-specific directory (`$HOME/.local/bin`).

3. **Ensure PATH Configuration**:
   - Checks if the installation directory (`$HOME/.local/bin`) is in the `PATH`.
   - Provides instructions to add it to the `PATH` if necessary.

This creates a binary at `~/.local/bin/xmonad`

```bash
# Create a distributable archive
tar -czvf xmonad-binary.tar.gz -C ~/.local/bin xmonad
```

## Target Machine Setup

Target machines only need X11 libraries, not Haskell:

```bash
# For Arch-based systems
pacman -S libx11 libxft libxinerama libxrandr libxss xterm

# For Debian-based systems
apt install libx11-6 libxft2 libxinerama1 libxrandr2 libxss1 xterm
```

### Configuration on Target Machine

1. Create configuration directory:
```bash
mkdir -p ~/.config/xmonad
```

2. Create a minimal xmonad.hs:
```bash
echo 'import XMonad

main :: IO ()
main = xmonad def' > ~/.config/xmonad/xmonad.hs
```

3. Set up .xinitrc:
```bash
echo 'exec xmonad' > ~/.xinitrc
```

### Recompilation
Whenever you update `xmonad.hs`, recompile it with:

```bash
xmonad --recompile
xmonad --restart
```

## Important Note on Recompilation

**The target machines cannot recompile your xmonad.hs without installing the libraries.**

If you need to modify xmonad.hs on target machines:
1. Copy it back to your build machine
2. Make changes there
3. Recompile
4. Redistribute the binary

This trade-off of flexibility for size and simplicity is the core of the "build factory" approach.

---
## Lessons Learned
**GHC environment file** (`.ghc.environment.x86_64-linux-9.4.8`). This file is automatically generated by `cabal` when you use the `--package-env` option, and it defines the package environment for GHC (the Haskell compiler)

**Xmonad the Default Configuration**
- **Mod Key**: The `Alt` key (`mod1Mask`) is used as the modifier key
- **Terminal**: Defaults to `xterm`
- **Key Bindings**:
  - `Mod + Shift + Enter`: Launches the terminal
  - `Mod + Shift + C`: Closes the focused window
  - `Mod + Space`: Switches between layouts
  - `Mod + Tab`: Cycles through windows
  - `Mod + Q`: Restarts xmonad
